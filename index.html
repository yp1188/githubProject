<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>4-Year Anniversary</title>
<style>
    body { margin:0; overflow:hidden; background:#111; color:white; font-family:sans-serif; }
    .love { position:absolute; color:pink; font-size:3rem; transition: transform 0.5s ease; }
</style>
</head>
<body>

<audio autoplay loop>
  <source src="anniversary-music.mp3" type="audio/mp3">
</audio>

<video id="camera" autoplay playsinline width="300" style="display:none;"></video>

<script>
const video = document.getElementById("camera");
navigator.mediaDevices.getUserMedia({ video: true }).then(stream => video.srcObject = stream);

const images = ["img1.jpg","img2.jpg","img3.jpg"];
let imgIndex = 0;

// Auto show images
setInterval(() => {
    const img = document.createElement("img");
    img.src = images[imgIndex];
    img.style.position = "absolute";
    img.style.top = `${Math.random()*80}vh`;
    img.style.left = `${Math.random()*80}vw`;
    img.style.width = "150px";
    document.body.appendChild(img);
    setTimeout(() => img.remove(), 1000);
    imgIndex = (imgIndex+1)%images.length;
}, 1000);

// LOVE popup every 3 seconds
function showLove(){
    const love = document.createElement("div");
    love.className = "love";
    love.innerText = "❤️ LOVE ❤️";
    love.style.top="50%"; love.style.left="50%"; love.style.transform="translate(-50%,-50%) scale(0)";
    document.body.appendChild(love);
    setTimeout(()=>love.style.transform="translate(-50%,-50%) scale(1)",50);
    setTimeout(()=>love.remove(),2000);
}
setInterval(showLove,3000);

// Capture frame for eye-tracking
function captureFrame(){
    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext("2d").drawImage(video,0,0,canvas.width,canvas.height);
    return canvas.toDataURL("image/jpeg");
}

// Send frame to Railway backend
async function sendFrame(){
    const base64 = captureFrame();
    const blob = await (await fetch(base64)).blob();
    const form = new FormData();
    form.append("file", blob,"photo1.jpg");
    try{
        const res = await fetch("https://your-app.up.railway.app/eye-tracking/", {method:"POST",body:form});
        const data = await res.json();
        if(data.x && data.y){
            const img = document.createElement("img");
            img.src="love.png";
            img.style.position="absolute";
            img.style.width="50px";
            img.style.left=`${data.x*window.innerWidth}px`;
            img.style.top=`${data.y*window.innerHeight}px`;
            document.body.appendChild(img);
            setTimeout(()=>img.remove(),1000);
        }
    }catch(err){ console.log(err); }
}

// Run eye-tracking every second
setInterval(sendFrame,1000);
</script>
</body>
</html>
